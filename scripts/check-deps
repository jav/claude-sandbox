#!/usr/bin/env bash
set -euo pipefail

errors=0

echo "Checking dependencies..."

# Check Docker
if command -v docker &>/dev/null; then
    echo "✓ docker: $(docker --version)"
else
    echo "✗ docker: not found"
    errors=$((errors + 1))
fi

# Check Docker Compose (v2 plugin or standalone)
if docker compose version &>/dev/null 2>&1; then
    echo "✓ docker compose: $(docker compose version --short)"
elif command -v docker-compose &>/dev/null; then
    echo "✓ docker-compose: $(docker-compose --version)"
else
    echo "✗ docker compose: not found"
    errors=$((errors + 1))
fi

# Check Docker daemon
if docker info &>/dev/null 2>&1; then
    echo "✓ docker daemon: running"
else
    echo "✗ docker daemon: not running or no permission"
    echo "  Try: sudo systemctl start docker"
    echo "  Or add yourself to docker group: sudo usermod -aG docker $USER"
    errors=$((errors + 1))
fi

echo ""
if [[ $errors -eq 0 ]]; then
    echo "All dependencies satisfied."
    exit 0
else
    echo "$errors dependency issue(s) found."
    exit 1
fi
